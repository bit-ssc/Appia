import type { AvatarProps } from '@rocket.chat/fuselage';
import { Avatar } from '@rocket.chat/fuselage';
import type { FC } from 'react';
import React, { useState } from 'react';

export type BaseAvatarProps = Omit<AvatarProps, 'is'>;

const BaseAvatar: FC<BaseAvatarProps> = ({ size, url, ...props }) => {
	const [error, setError] = useState<unknown>(false);

	if (error) {
		const nSize = parseInt(size?.replace('x', '') ?? '36');
		if (url.includes('room')) {
			return (
				<svg width={nSize} height={nSize} viewBox='0 0 36 36' fill='none' xmlns='http://www.w3.org/2000/svg'>
					<rect width={36} height={36} rx={18} fill='#C9CDD4' />
					<path
						d='M17.9031 16.5969H17.9969C20.1625 16.5719 21.9125 14.8438 21.9125 12.7188V11.425C21.9125 9.28125 20.1375 7.54375 17.95 7.54375C15.7625 7.54375 13.9875 9.28125 13.9875 11.425V12.7188C13.9875 14.8438 15.7375 16.5719 17.9031 16.5969ZM25.5906 17.1625C26.9969 17.1625 28.1375 16.075 28.1375 14.7375V13.925C28.1375 12.5844 26.9969 11.5 25.5906 11.5C24.1844 11.5 23.0438 12.5875 23.0438 13.925V14.7344C23.0438 16.075 24.1844 17.1625 25.5906 17.1625ZM10.3094 17.1625C11.7156 17.1625 12.8562 16.075 12.8562 14.7375V13.925C12.8562 12.5844 11.7156 11.5 10.3094 11.5C8.90312 11.5 7.7625 12.5875 7.7625 13.925V14.7344C7.75937 16.075 8.9 17.1625 10.3094 17.1625ZM6.63438 19.6313C5.96563 19.9719 5.5 20.7344 5.5 21.6281V22.625C5.5 23.2844 5.88125 23.8344 6.40312 24.0156C7.21562 24.2281 8.04688 24.3688 8.89687 24.4469V22.6875C8.89687 21.1156 9.46563 19.7375 10.3313 18.8656H10.3094C9.01562 18.8594 7.775 19.1344 6.63438 19.6313ZM29.275 19.6344C28.1313 19.1344 26.8906 18.8594 25.5906 18.8594H25.5719C26.4406 19.7344 27.0063 21.1125 27.0063 22.6813V24.4438C27.8531 24.3656 28.6875 24.225 29.4937 24.0125C30.0156 23.8344 30.4031 23.2813 30.4031 22.6188V21.6313C30.4031 20.7375 29.9375 19.9781 29.275 19.6344ZM23.5812 19.5344C21.8312 18.7312 19.9344 18.2906 17.95 18.2906C15.9688 18.2906 14.0781 18.7313 12.3313 19.5281C11.3094 20.0688 10.5938 21.2906 10.5938 22.7188V24.3125C10.5938 25.3687 11.1781 26.2531 11.975 26.5406C13.9 27.0625 15.8969 27.35 17.9531 27.35C20.0063 27.35 22 27.0688 23.9219 26.5438C24.725 26.2594 25.3094 25.3719 25.3094 24.3156V22.7219C25.3094 21.2969 24.5969 20.0781 23.5812 19.5344Z'
						fill='white'
					/>
				</svg>
			);
		}

		return (
			<svg width={nSize} height={nSize} viewBox='0 0 36 36' fill='none' xmlns='http://www.w3.org/2000/svg'>
				<g clipPath='url(#clip0_4674_15416)'>
					<rect width={36} height={36} rx={18} fill='white' />
					<path
						d='M36 18.0186C36 27.9487 27.9405 36 17.9981 36C8.0566 36 0 27.9486 0 18.0186C0 10.3965 4.74454 3.88465 11.4451 1.26766C13.4697 0.451003 15.6815 0 17.9986 0C20.3185 0 22.5284 0.450547 24.5549 1.26766C31.255 3.88465 36 10.3966 36 18.0186ZM11.08 14.2265C11.08 17.2567 12.6327 19.8803 14.8898 21.1645C15.8259 21.6971 16.8799 22.0043 17.9981 22.0043C19.0771 22.0043 20.0943 21.7169 21.0059 21.2206C23.3164 19.9609 24.9191 17.3053 24.9191 14.227C24.9191 9.94083 21.8151 6.45204 17.9982 6.45204C14.1835 6.45158 11.08 9.94041 11.08 14.2265ZM18.0712 34.8348C23.33 34.8348 28.0212 32.4164 31.096 28.6318C30.7328 25.6464 27.8235 23.105 23.7061 21.8373C22.151 23.2361 20.1642 24.0778 17.9976 24.0778C15.7829 24.0778 13.7556 23.1908 12.1854 21.7311C8.18019 22.8742 5.24649 25.2058 4.55863 27.9996C7.60979 32.1442 12.5275 34.8348 18.0712 34.8348Z'
						fill='#C9CDD4'
					/>
				</g>
				<defs>
					<clipPath id='clip0_4674_15416'>
						<rect width={36} height={36} rx={18} fill='white' />
					</clipPath>
				</defs>
			</svg>
		);
	}

	let href = url;

	if (url && !/^data:/.test(url)) {
		href = `${url}${/\?/.test(url) ? '&v=5' : '?v=5'}`;
	}

	return <Avatar aria-hidden onError={setError} size={size} url={href} {...props} />;
};

export default BaseAvatar;
